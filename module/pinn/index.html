<!--
  This Basic theme serves as an example for how to create other
  themes by demonstrating the features with minimal HTML and CSS.
  Comments like this will be through the code to explain briefly
  what each feature is and point you to the MkDocs documentation
  to find out more.
-->
<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <!--
    The page_title contains the title for a page as shown in the navigation.
    Site name contains the name as defined in the mkdocs.yml
  -->
  <title>PiNN - PiNNAcLe</title>

  <link rel="stylesheet" href="../../css/theme.css">
  <link rel="stylesheet" href="../../css/notebook.css">
  <link rel="stylesheet" href="../../css/pygments.css">
  <link rel="icon" href="data:,">
  

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,600;1,400;1,700&family=Noto+Sans:ital,wght@0,400;0,600;1,400;1,600&display=swap" rel="stylesheet">
  <script
  src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
  integrity="sha256-3edrmyuQ0w65f8gfBsqowzjJe2iM6n0nKciPUp8y+7E="
  crossorigin="anonymous"></script>

  <script>
    var base_url = "../..";
    $(document).ready(function(){
          $('table').wrap('<div class="table-wrapper"></div>');
    });
  </script>

  <script src="../../js/mike.js"></script>

  
    <script src="../../js/mathjax.js"></script>
  
    <script src="../../search/main.js"></script>
  

</head>

<body>
  <header class="header">
    <ul>
      <li id="logo">
        <a href="../..">PiNN<span>AcLe</span></a>
      </li>
      
      
  <li  class="tab" >
    <a href="../.." class="">
      Home
    </a>
  </li>

      
      
  
  <li  class="tab" >
    <a href="../../tutorial/get_started/">
      Tutorial
    </a>
  </li>

      
      
  
  <li class="active tab" >
    <a href="../../manual/">
      Manual
    </a>
  </li>

      
      
  
  <li  class="tab" >
    <a href="../../profiles/overview/">
      Profiles
    </a>
  </li>

      
      <li class="tools">
        
          <a id="nav-toggle" class="tool" onclick="nav_toggle()">
        
          <svg><use xlink:href="../../svg/sprite.svg#menu-2"></use></svg>
        </a>
        <script>
           function nav_toggle() {
               var bar = document.getElementById("tab-bar");
               if (bar.style.display === "none") {
                   bar.style.display = "block";
               } else {
                   bar.style.display = "none";
               }
           }
          function nav_reset() {
              var bar = document.getElementById("tab-bar");
              if (window.innerWidth>950){
                  bar.style.display = "block";
              } else {
                  bar.style.display = "none";
              }
          }
          window.onresize = nav_reset;
        </script>
        
        
        <a class="tool" href="https://github.com/teoroo-cmc/pinnacle/">
          <svg><use xlink:href="../../svg/sprite.svg#brand-github"></use></svg>
          <span>teoroo-cmc/pinnacle</span>
        </a>
        
      </li>
    </ul>
  </header>


  <div id="main">
    <div id="tab-bar">
      <ul>
      
       
  <li  class="tab" >
    <a href="../.." class="">
      Home
    </a>
  </li>

         
           <div class="nav-bar">
             <ul>
               
             </ul>
           </div>
         
      
       
  
  <li  class="tab" >
    <a href="../../tutorial/get_started/">
      Tutorial
    </a>
  </li>

         
           <div class="nav-bar">
             <ul>
               
             </ul>
           </div>
         
      
       
  
  <li class="active tab" >
    <a href="../../manual/">
      Manual
    </a>
  </li>

         
           <div class="nav-bar">
             <ul>
               
                 
                   
    <li >
      <a href="../../manual/" class="">
        Overview
      </a>
    </li>

                 
                   
  <a class="nav-title" > Recipes </a>
  
    
    <li >
      <a href="../../recipe/acle/" class="">
        AcLe
      </a>
    </li>

  

                 
                   
  <a class="nav-title" > Modules </a>
  
    
    <li >
      <a href="../tips/" class="">
        TIPS
      </a>
    </li>

  
    
    <li class="active">
      <a href="./" class="">
        PiNN
      </a>
    </li>

  
    
    <li >
      <a href="../cp2k/" class="">
        CP2K
      </a>
    </li>

  
    
    <li >
      <a href="../ase/" class="">
        ASE
      </a>
    </li>

  
    
    <li >
      <a href="../dftb/" class="">
        DFTB+
      </a>
    </li>

  
    
    <li >
      <a href="../molutils/" class="">
        molutils
      </a>
    </li>

  
    
    <li >
      <a href="../lammps/" class="">
        LAMMPS
      </a>
    </li>

  

                 
               
             </ul>
           </div>
         
      
       
  
  <li  class="tab" >
    <a href="../../profiles/overview/">
      Profiles
    </a>
  </li>

         
           <div class="nav-bar">
             <ul>
               
             </ul>
           </div>
         
      
      </ul>
    </div>

    <div id="content">
      <h1 id="pinn-workflows">PiNN workflows</h1>
<h2 id="pinntrain">pinnTrain</h2>
<p>The <code>pinnTrain</code> process runs a training given a dataset and a PiNN input file.
The input file can optionally be a model folder in such case the process
contines training from the last checkpoint available. For list of flags
available, see the <a href="https://teoroo-cmc.github.io/PiNN/master/usage/cli/train/">PiNN
documentation</a>.</p>
<h3 id="input-channels">Input Channels</h3>
<table>
<thead>
<tr>
<th>Channel</th>
<th>Type</th>
<th>i/o</th>
<th>Note</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>name</code></td>
<td><code>val</code></td>
<td><code>in[0]</code></td>
<td>an id to identify the process</td>
</tr>
<tr>
<td><code>dataset</code></td>
<td><code>file</code></td>
<td><code>in[1]</code></td>
<td>a dataset recognizable by PiNN</td>
</tr>
<tr>
<td><code>input</code></td>
<td><code>file</code></td>
<td><code>in[2]</code></td>
<td>a PiNN <code>.yml</code> input file</td>
</tr>
<tr>
<td><code>flag</code></td>
<td><code>val</code></td>
<td><code>in[3]</code></td>
<td>flags for <code>pinn train</code></td>
</tr>
<tr>
<td><code>name</code></td>
<td><code>val</code></td>
<td><code>out.*[0]</code></td>
<td>same as input</td>
</tr>
<tr>
<td><code>model</code></td>
<td><code>file</code></td>
<td><code>out.model[1]</code></td>
<td>Trained PiNN model</td>
</tr>
<tr>
<td><code>log</code></td>
<td><code>file</code></td>
<td><code>out.log[2]</code></td>
<td>PiNN log (the evaluation errors)</td>
</tr>
</tbody>
</table>
<h2 id="pinnmd">pinnMD</h2>
<p>The <code>pinnMD</code> process takes a trained model and runs a MD trajecotry, with some
limited options regarding the dynamics. The process suppors PiNN models only for
now. A list of models can be supplied to run an ensemble MD. For more complex
processes, consider writing a customized MD process and include it in your
workflow.</p>
<h3 id="input-channels_1">Input Channels</h3>
<table>
<thead>
<tr>
<th>Channel</th>
<th>Type</th>
<th>i/o</th>
<th>Note</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>name</code></td>
<td><code>val</code></td>
<td><code>in[0]</code></td>
<td>an id to identify the process</td>
</tr>
<tr>
<td><code>model</code></td>
<td><code>file</code></td>
<td><code>in[1]</code></td>
<td>trained PiNN model, can be a list of models</td>
</tr>
<tr>
<td><code>init</code></td>
<td><code>file</code></td>
<td><code>in[2]</code></td>
<td>initial geometry, in any ASE recognizable format</td>
</tr>
<tr>
<td><code>flags</code></td>
<td><code>val</code></td>
<td><code>in[3]</code></td>
<td>a string specifying the MD simulation see <a href="#options">options</a> below</td>
</tr>
<tr>
<td><code>name</code></td>
<td><code>val</code></td>
<td><code>out.*[0]</code></td>
<td>same as input</td>
</tr>
<tr>
<td><code>traj</code></td>
<td><code>file</code></td>
<td><code>out.traj[1]</code></td>
<td>output trajectory</td>
</tr>
<tr>
<td><code>log</code></td>
<td><code>file</code></td>
<td><code>out.log[1]</code></td>
<td>MD log</td>
</tr>
</tbody>
</table>
<h3 id="options">Options</h3>
<p>The flags for pinnMD is specified in the form of <code>--option1 val1 --option2 val</code>,
the available options and default valeus are listed below.</p>
<table>
<thead>
<tr>
<th>Option</th>
<th>Default</th>
<th>Note</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>--ensemble</code></td>
<td><code>'nvt'</code></td>
<td><code>'npt'</code> or <code>'nvt'</code></td>
</tr>
<tr>
<td><code>--T</code></td>
<td><code>273</code></td>
<td>Temperature in K</td>
</tr>
<tr>
<td><code>--t</code></td>
<td><code>100</code></td>
<td>Time in ps</td>
</tr>
<tr>
<td><code>--dt</code></td>
<td><code>0.5</code></td>
<td>Time step in fs</td>
</tr>
<tr>
<td><code>--taut</code></td>
<td><code>100</code></td>
<td>Damping factor for thermostat in steps</td>
</tr>
<tr>
<td><code>--taup</code></td>
<td><code>1000</code></td>
<td>Damping factor for barostat in steps</td>
</tr>
<tr>
<td><code>--log-every</code></td>
<td><code>5</code></td>
<td>Log interval in steps</td>
</tr>
<tr>
<td><code>--pressure</code></td>
<td><code>1</code></td>
<td>pressure in bar</td>
</tr>
<tr>
<td><code>--compressibility</code></td>
<td><code>4.57e-5</code></td>
<td>compressibility in bar</td>
</tr>
</tbody>
</table>
<details>
<summary>Source code</summary>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">nextflow</span><span class="o">.</span><span class="na">enable</span><span class="o">.</span><span class="na">dsl</span><span class="o">=</span><span class="mi">2</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="n">params</span><span class="o">.</span><span class="na">publish</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;pinn&#39;</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="n">process</span><span class="w"> </span><span class="n">train</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="w">  </span><span class="n">label</span><span class="w"> </span><span class="s1">&#39;pinn&#39;</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="w">  </span><span class="n">publishDir</span><span class="w"> </span><span class="s2">&quot;$params.publish/$name&quot;</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="w">  </span><span class="nl">input:</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="w">    </span><span class="n">tuple</span><span class="w"> </span><span class="n">val</span><span class="o">(</span><span class="n">name</span><span class="o">),</span><span class="w"> </span><span class="n">path</span><span class="o">(</span><span class="n">dataset</span><span class="o">),</span><span class="w"> </span><span class="n">path</span><span class="o">(</span><span class="n">input</span><span class="o">,</span><span class="w"> </span><span class="nl">stageAs:</span><span class="s1">&#39;input&#39;</span><span class="o">),</span><span class="w"> </span><span class="n">val</span><span class="o">(</span><span class="n">flags</span><span class="o">)</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="w">  </span><span class="nl">output:</span>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="w">    </span><span class="n">tuple</span><span class="w"> </span><span class="n">val</span><span class="o">(</span><span class="n">name</span><span class="o">),</span><span class="w"> </span><span class="n">path</span><span class="o">(</span><span class="s1">&#39;model&#39;</span><span class="o">,</span><span class="w"> </span><span class="nl">type:</span><span class="s1">&#39;dir&#39;</span><span class="o">),</span><span class="w"> </span><span class="nl">emit:</span><span class="w"> </span><span class="n">model</span>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="w">    </span><span class="n">tuple</span><span class="w"> </span><span class="n">val</span><span class="o">(</span><span class="n">name</span><span class="o">),</span><span class="w"> </span><span class="n">path</span><span class="o">(</span><span class="s1">&#39;pinn.log&#39;</span><span class="o">),</span><span class="w"> </span><span class="nl">emit:</span><span class="w"> </span><span class="n">log</span>
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="w">  </span><span class="nl">script:</span>
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="w">    </span><span class="n">convert_flag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${(flags =~ /--seed[\s,\=]\d+/)[0]}&quot;</span>
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a><span class="w">    </span><span class="n">train_flags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;${flags.replaceAll(/--seed[\s,\=]\d+/, &#39;&#39;)}&quot;</span>
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a><span class="w">    </span><span class="n">dataset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">(</span><span class="n">dataset</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">Path</span><span class="o">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">dataset</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">dataset</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="na">baseName</span><span class="o">+</span><span class="s1">&#39;.yml&#39;</span>
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a><span class="w">    </span><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a><span class="s2">    #!/bin/bash</span>
<a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a>
<a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a><span class="s2">    pinn convert $dataset -o &#39;train:9,eval:1&#39; $convert_flag</span>
<a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a>
<a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a><span class="s2">    if [ ! -f $input/params.yml ];  then</span>
<a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a><span class="s2">        mkdir -p model; cp $input model/params.yml</span>
<a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a><span class="s2">    else</span>
<a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a><span class="s2">        cp -rL $input model</span>
<a id="__codelineno-0-29" name="__codelineno-0-29" href="#__codelineno-0-29"></a><span class="s2">    fi</span>
<a id="__codelineno-0-30" name="__codelineno-0-30" href="#__codelineno-0-30"></a><span class="s2">    pinn train model/params.yml --model-dir=&#39;model&#39;\</span>
<a id="__codelineno-0-31" name="__codelineno-0-31" href="#__codelineno-0-31"></a><span class="s2">        --train-ds=&#39;train.yml&#39; --eval-ds=&#39;eval.yml&#39;\</span>
<a id="__codelineno-0-32" name="__codelineno-0-32" href="#__codelineno-0-32"></a><span class="s2">        $train_flags</span>
<a id="__codelineno-0-33" name="__codelineno-0-33" href="#__codelineno-0-33"></a><span class="s2">    pinn log model/eval &gt; pinn.log</span>
<a id="__codelineno-0-34" name="__codelineno-0-34" href="#__codelineno-0-34"></a><span class="s2">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-35" name="__codelineno-0-35" href="#__codelineno-0-35"></a><span class="o">}</span>
<a id="__codelineno-0-36" name="__codelineno-0-36" href="#__codelineno-0-36"></a>
<a id="__codelineno-0-37" name="__codelineno-0-37" href="#__codelineno-0-37"></a><span class="n">process</span><span class="w"> </span><span class="n">md</span><span class="w"> </span><span class="o">{</span>
<a id="__codelineno-0-38" name="__codelineno-0-38" href="#__codelineno-0-38"></a><span class="w">  </span><span class="n">label</span><span class="w"> </span><span class="s1">&#39;pinn&#39;</span>
<a id="__codelineno-0-39" name="__codelineno-0-39" href="#__codelineno-0-39"></a><span class="w">  </span><span class="n">publishDir</span><span class="w"> </span><span class="s2">&quot;$params.publish/$name&quot;</span>
<a id="__codelineno-0-40" name="__codelineno-0-40" href="#__codelineno-0-40"></a>
<a id="__codelineno-0-41" name="__codelineno-0-41" href="#__codelineno-0-41"></a><span class="w">  </span><span class="nl">input:</span>
<a id="__codelineno-0-42" name="__codelineno-0-42" href="#__codelineno-0-42"></a><span class="w">    </span><span class="n">tuple</span><span class="w"> </span><span class="n">val</span><span class="o">(</span><span class="n">name</span><span class="o">),</span><span class="w"> </span><span class="n">path</span><span class="o">(</span><span class="n">model</span><span class="o">,</span><span class="nl">stageAs:</span><span class="s1">&#39;model*&#39;</span><span class="o">),</span><span class="w"> </span><span class="n">path</span><span class="o">(</span><span class="n">init</span><span class="o">,</span><span class="w"> </span><span class="nl">stageAs:</span><span class="s1">&#39;init*&#39;</span><span class="o">),</span><span class="w"> </span><span class="n">val</span><span class="o">(</span><span class="n">flags</span><span class="o">)</span>
<a id="__codelineno-0-43" name="__codelineno-0-43" href="#__codelineno-0-43"></a>
<a id="__codelineno-0-44" name="__codelineno-0-44" href="#__codelineno-0-44"></a><span class="w">  </span><span class="nl">output:</span>
<a id="__codelineno-0-45" name="__codelineno-0-45" href="#__codelineno-0-45"></a><span class="w">    </span><span class="n">tuple</span><span class="w"> </span><span class="n">val</span><span class="o">(</span><span class="n">name</span><span class="o">),</span><span class="w"> </span><span class="n">path</span><span class="o">(</span><span class="s1">&#39;asemd.traj&#39;</span><span class="o">),</span><span class="w"> </span><span class="nl">emit:</span><span class="w"> </span><span class="n">traj</span>
<a id="__codelineno-0-46" name="__codelineno-0-46" href="#__codelineno-0-46"></a><span class="w">    </span><span class="n">tuple</span><span class="w"> </span><span class="n">val</span><span class="o">(</span><span class="n">name</span><span class="o">),</span><span class="w"> </span><span class="n">path</span><span class="o">(</span><span class="s1">&#39;asemd.log&#39;</span><span class="o">),</span><span class="w"> </span><span class="nl">emit:</span><span class="w"> </span><span class="n">log</span>
<a id="__codelineno-0-47" name="__codelineno-0-47" href="#__codelineno-0-47"></a>
<a id="__codelineno-0-48" name="__codelineno-0-48" href="#__codelineno-0-48"></a><span class="w">  </span><span class="nl">script:</span>
<a id="__codelineno-0-49" name="__codelineno-0-49" href="#__codelineno-0-49"></a><span class="w">    </span><span class="s2">&quot;&quot;&quot;</span>
<a id="__codelineno-0-50" name="__codelineno-0-50" href="#__codelineno-0-50"></a><span class="s2">    #!/usr/bin/env python</span>
<a id="__codelineno-0-51" name="__codelineno-0-51" href="#__codelineno-0-51"></a><span class="s2">    import re</span>
<a id="__codelineno-0-52" name="__codelineno-0-52" href="#__codelineno-0-52"></a><span class="s2">    import pinn</span>
<a id="__codelineno-0-53" name="__codelineno-0-53" href="#__codelineno-0-53"></a><span class="s2">    import tensorflow as tf</span>
<a id="__codelineno-0-54" name="__codelineno-0-54" href="#__codelineno-0-54"></a><span class="s2">    from ase import units</span>
<a id="__codelineno-0-55" name="__codelineno-0-55" href="#__codelineno-0-55"></a><span class="s2">    from ase.io import read</span>
<a id="__codelineno-0-56" name="__codelineno-0-56" href="#__codelineno-0-56"></a><span class="s2">    from ase.io.trajectory import Trajectory</span>
<a id="__codelineno-0-57" name="__codelineno-0-57" href="#__codelineno-0-57"></a><span class="s2">    from ase.md import MDLogger</span>
<a id="__codelineno-0-58" name="__codelineno-0-58" href="#__codelineno-0-58"></a><span class="s2">    from ase.md.velocitydistribution import MaxwellBoltzmannDistribution</span>
<a id="__codelineno-0-59" name="__codelineno-0-59" href="#__codelineno-0-59"></a><span class="s2">    from ase.md.nptberendsen import NPTBerendsen</span>
<a id="__codelineno-0-60" name="__codelineno-0-60" href="#__codelineno-0-60"></a><span class="s2">    from ase.md.nvtberendsen import NVTBerendsen</span>
<a id="__codelineno-0-61" name="__codelineno-0-61" href="#__codelineno-0-61"></a><span class="s2">    from tips.bias import EnsembleBiasedCalculator</span>
<a id="__codelineno-0-62" name="__codelineno-0-62" href="#__codelineno-0-62"></a>
<a id="__codelineno-0-63" name="__codelineno-0-63" href="#__codelineno-0-63"></a><span class="s2">    # ------------ patch ase properties to write extra cols --------------------</span>
<a id="__codelineno-0-64" name="__codelineno-0-64" href="#__codelineno-0-64"></a><span class="s2">    from ase.calculators.calculator import all_properties</span>
<a id="__codelineno-0-65" name="__codelineno-0-65" href="#__codelineno-0-65"></a><span class="s2">    all_properties+=[f&#39;{prop}_{extra}&#39; for prop in [&#39;energy&#39;, &#39;forces&#39;, &#39;stress&#39;] for extra in [&#39;avg&#39;,&#39;std&#39;,&#39;bias&#39;]]</span>
<a id="__codelineno-0-66" name="__codelineno-0-66" href="#__codelineno-0-66"></a><span class="s2">    # --------------------------------------------------------------------------</span>
<a id="__codelineno-0-67" name="__codelineno-0-67" href="#__codelineno-0-67"></a>
<a id="__codelineno-0-68" name="__codelineno-0-68" href="#__codelineno-0-68"></a><span class="s2">    setup = {</span>
<a id="__codelineno-0-69" name="__codelineno-0-69" href="#__codelineno-0-69"></a><span class="s2">      &#39;ensemble&#39;: &#39;nvt&#39;, # ensemble</span>
<a id="__codelineno-0-70" name="__codelineno-0-70" href="#__codelineno-0-70"></a><span class="s2">      &#39;T&#39;: 340, # temperature in K</span>
<a id="__codelineno-0-71" name="__codelineno-0-71" href="#__codelineno-0-71"></a><span class="s2">      &#39;t&#39;: 50, # time in ps</span>
<a id="__codelineno-0-72" name="__codelineno-0-72" href="#__codelineno-0-72"></a><span class="s2">      &#39;dt&#39;: 0.5, # timestep is fs</span>
<a id="__codelineno-0-73" name="__codelineno-0-73" href="#__codelineno-0-73"></a><span class="s2">      &#39;taut&#39;: 100, # thermostat damping in steps</span>
<a id="__codelineno-0-74" name="__codelineno-0-74" href="#__codelineno-0-74"></a><span class="s2">      &#39;taup&#39;: 1000, # barastat dampling in steps</span>
<a id="__codelineno-0-75" name="__codelineno-0-75" href="#__codelineno-0-75"></a><span class="s2">      &#39;log-every&#39;: 20, # log interval in steps</span>
<a id="__codelineno-0-76" name="__codelineno-0-76" href="#__codelineno-0-76"></a><span class="s2">      &#39;pressure&#39;: 1, # pressure in bar</span>
<a id="__codelineno-0-77" name="__codelineno-0-77" href="#__codelineno-0-77"></a><span class="s2">      &#39;compressibility&#39;: 4.57e-4, # compressibility in bar^{-1}</span>
<a id="__codelineno-0-78" name="__codelineno-0-78" href="#__codelineno-0-78"></a><span class="s2">      &#39;bias&#39;: None,</span>
<a id="__codelineno-0-79" name="__codelineno-0-79" href="#__codelineno-0-79"></a><span class="s2">      &#39;kb&#39;: 0,</span>
<a id="__codelineno-0-80" name="__codelineno-0-80" href="#__codelineno-0-80"></a><span class="s2">      &#39;sigma0&#39;: 0,</span>
<a id="__codelineno-0-81" name="__codelineno-0-81" href="#__codelineno-0-81"></a><span class="s2">    }</span>
<a id="__codelineno-0-82" name="__codelineno-0-82" href="#__codelineno-0-82"></a>
<a id="__codelineno-0-83" name="__codelineno-0-83" href="#__codelineno-0-83"></a><span class="s2">    flags = {</span>
<a id="__codelineno-0-84" name="__codelineno-0-84" href="#__codelineno-0-84"></a><span class="s2">      k: v for k,v in</span>
<a id="__codelineno-0-85" name="__codelineno-0-85" href="#__codelineno-0-85"></a><span class="s2">        re.findall(&#39;--(.*?)[\\s,\\=]([^\\s]*)&#39;, &quot;$flags&quot;)</span>
<a id="__codelineno-0-86" name="__codelineno-0-86" href="#__codelineno-0-86"></a><span class="s2">    }</span>
<a id="__codelineno-0-87" name="__codelineno-0-87" href="#__codelineno-0-87"></a><span class="s2">    setup.update(flags)</span>
<a id="__codelineno-0-88" name="__codelineno-0-88" href="#__codelineno-0-88"></a><span class="s2">    ensemble=setup[&#39;ensemble&#39;]</span>
<a id="__codelineno-0-89" name="__codelineno-0-89" href="#__codelineno-0-89"></a><span class="s2">    T=float(setup[&#39;T&#39;])</span>
<a id="__codelineno-0-90" name="__codelineno-0-90" href="#__codelineno-0-90"></a><span class="s2">    t=float(setup[&#39;t&#39;])*units.fs*1e3</span>
<a id="__codelineno-0-91" name="__codelineno-0-91" href="#__codelineno-0-91"></a><span class="s2">    dt=float(setup[&#39;dt&#39;])*units.fs</span>
<a id="__codelineno-0-92" name="__codelineno-0-92" href="#__codelineno-0-92"></a><span class="s2">    taut=int(setup[&#39;taut&#39;])</span>
<a id="__codelineno-0-93" name="__codelineno-0-93" href="#__codelineno-0-93"></a><span class="s2">    taup=int(setup[&#39;taup&#39;])</span>
<a id="__codelineno-0-94" name="__codelineno-0-94" href="#__codelineno-0-94"></a><span class="s2">    every=int(setup[&#39;log-every&#39;])</span>
<a id="__codelineno-0-95" name="__codelineno-0-95" href="#__codelineno-0-95"></a><span class="s2">    pressure=float(setup[&#39;pressure&#39;])</span>
<a id="__codelineno-0-96" name="__codelineno-0-96" href="#__codelineno-0-96"></a><span class="s2">    compressibility=float(setup[&#39;compressibility&#39;])</span>
<a id="__codelineno-0-97" name="__codelineno-0-97" href="#__codelineno-0-97"></a>
<a id="__codelineno-0-98" name="__codelineno-0-98" href="#__codelineno-0-98"></a><span class="s2">    ${(model instanceof Path) ?</span>
<a id="__codelineno-0-99" name="__codelineno-0-99" href="#__codelineno-0-99"></a><span class="s2">    &quot;calc = pinn.get_calc(&#39;$model&#39;)&quot; :</span>
<a id="__codelineno-0-100" name="__codelineno-0-100" href="#__codelineno-0-100"></a><span class="s2">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-101" name="__codelineno-0-101" href="#__codelineno-0-101"></a><span class="w">    </span><span class="n">models</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="s2">&quot;${model.join(&#39;&quot;</span><span class="o">,</span><span class="w"> </span><span class="s2">&quot;&#39;)}&quot;</span><span class="o">]</span>
<a id="__codelineno-0-102" name="__codelineno-0-102" href="#__codelineno-0-102"></a><span class="w">    </span><span class="n">calcs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">[</span><span class="n">pinn</span><span class="o">.</span><span class="na">get_calc</span><span class="o">(</span><span class="n">model</span><span class="o">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">model</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">models</span><span class="o">]</span>
<a id="__codelineno-0-103" name="__codelineno-0-103" href="#__codelineno-0-103"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">len</span><span class="o">(</span><span class="n">calcs</span><span class="o">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span>
<a id="__codelineno-0-104" name="__codelineno-0-104" href="#__codelineno-0-104"></a><span class="w">        </span><span class="n">calc</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="n">calcs</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>
<a id="__codelineno-0-105" name="__codelineno-0-105" href="#__codelineno-0-105"></a><span class="w">    </span><span class="k">else</span><span class="o">:</span>
<a id="__codelineno-0-106" name="__codelineno-0-106" href="#__codelineno-0-106"></a><span class="w">        </span><span class="n">calc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EnsembleBiasedCalculator</span><span class="o">(</span><span class="n">calcs</span><span class="o">,</span>
<a id="__codelineno-0-107" name="__codelineno-0-107" href="#__codelineno-0-107"></a><span class="w">                                        </span><span class="n">bias</span><span class="o">=</span><span class="n">setup</span><span class="o">[</span><span class="s1">&#39;bias&#39;</span><span class="o">],</span>
<a id="__codelineno-0-108" name="__codelineno-0-108" href="#__codelineno-0-108"></a><span class="w">                                        </span><span class="n">kb</span><span class="o">=</span><span class="kt">float</span><span class="o">(</span><span class="n">setup</span><span class="o">[</span><span class="s1">&#39;kb&#39;</span><span class="o">]),</span>
<a id="__codelineno-0-109" name="__codelineno-0-109" href="#__codelineno-0-109"></a><span class="w">                                        </span><span class="n">sigma0</span><span class="o">=</span><span class="kt">float</span><span class="o">(</span><span class="n">setup</span><span class="o">[</span><span class="s1">&#39;sigma0&#39;</span><span class="o">]))</span>
<a id="__codelineno-0-110" name="__codelineno-0-110" href="#__codelineno-0-110"></a><span class="w">    </span><span class="s2">&quot;&quot;&quot;}</span>
<a id="__codelineno-0-111" name="__codelineno-0-111" href="#__codelineno-0-111"></a>
<a id="__codelineno-0-112" name="__codelineno-0-112" href="#__codelineno-0-112"></a><span class="s2">    atoms = read(&quot;$init&quot;)</span>
<a id="__codelineno-0-113" name="__codelineno-0-113" href="#__codelineno-0-113"></a><span class="s2">    atoms.set_calculator(calc)</span>
<a id="__codelineno-0-114" name="__codelineno-0-114" href="#__codelineno-0-114"></a><span class="s2">    if not atoms.has(&#39;momenta&#39;):</span>
<a id="__codelineno-0-115" name="__codelineno-0-115" href="#__codelineno-0-115"></a><span class="s2">        MaxwellBoltzmannDistribution(atoms, T*units.kB)</span>
<a id="__codelineno-0-116" name="__codelineno-0-116" href="#__codelineno-0-116"></a>
<a id="__codelineno-0-117" name="__codelineno-0-117" href="#__codelineno-0-117"></a><span class="s2">    if ensemble == &#39;npt&#39;:</span>
<a id="__codelineno-0-118" name="__codelineno-0-118" href="#__codelineno-0-118"></a><span class="s2">        dyn = NPTBerendsen(atoms, timestep=dt, temperature=T, pressure=pressure,</span>
<a id="__codelineno-0-119" name="__codelineno-0-119" href="#__codelineno-0-119"></a><span class="s2">                      taut=dt * taut, taup=dt * taup, compressibility=compressibility)</span>
<a id="__codelineno-0-120" name="__codelineno-0-120" href="#__codelineno-0-120"></a><span class="s2">    if ensemble == &#39;nvt&#39;:</span>
<a id="__codelineno-0-121" name="__codelineno-0-121" href="#__codelineno-0-121"></a><span class="s2">        dyn = NVTBerendsen(atoms, timestep=dt, temperature=T, taut=dt * taut)</span>
<a id="__codelineno-0-122" name="__codelineno-0-122" href="#__codelineno-0-122"></a>
<a id="__codelineno-0-123" name="__codelineno-0-123" href="#__codelineno-0-123"></a><span class="s2">    dyn.attach(</span>
<a id="__codelineno-0-124" name="__codelineno-0-124" href="#__codelineno-0-124"></a><span class="s2">        MDLogger(dyn, atoms, &#39;asemd.log&#39;,stress=True, mode=&quot;w&quot;),</span>
<a id="__codelineno-0-125" name="__codelineno-0-125" href="#__codelineno-0-125"></a><span class="s2">        interval=int(every))</span>
<a id="__codelineno-0-126" name="__codelineno-0-126" href="#__codelineno-0-126"></a><span class="s2">    dyn.attach(</span>
<a id="__codelineno-0-127" name="__codelineno-0-127" href="#__codelineno-0-127"></a><span class="s2">        Trajectory(&#39;asemd.traj&#39;, &#39;w&#39;, atoms).write,</span>
<a id="__codelineno-0-128" name="__codelineno-0-128" href="#__codelineno-0-128"></a><span class="s2">        interval=int(every))</span>
<a id="__codelineno-0-129" name="__codelineno-0-129" href="#__codelineno-0-129"></a><span class="s2">    dyn.run(int(t/dt))</span>
<a id="__codelineno-0-130" name="__codelineno-0-130" href="#__codelineno-0-130"></a><span class="s2">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-131" name="__codelineno-0-131" href="#__codelineno-0-131"></a><span class="o">}</span>
</code></pre></div>
</details>
    </div>

  </div>

  <div class="page">
    <div class="page-prev">
      
      <a href="../tips/" title="TIPS"><span>«</span> Previous</a>
      
    </div>
    <div class="page-next">
      
      <a href="../cp2k/" title="CP2K" />Next <span>»</span></a>
      
    </div>
  </div>

  <div class="footer">
    Built with <a href="https://www.mkdocs.org">mkdocs</a> and the <a href="https://github.com/yqshao/mkdocs-flux-theme">flux</a> theme.
  </div>
</body>
</html>